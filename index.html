
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sword Art Online: Aincrad Chronicles</title>
    
    <link rel="stylesheet" href="css/style-wiki.css">
    <link rel="stylesheet" href="css/style-game.css">
    <link rel="stylesheet" href="css/custom-scroll.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@600;800&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        #server-error-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 9999;
            color: #ff6b6b; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; font-family: sans-serif; padding: 20px;
        }
    </style>
    <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.sh/@google/genai@^1.34.0"
      }
    }
    </script>
</head>

<body>
    <div id="server-error-overlay">
        <h1>‚ö†Ô∏è Error de Ejecuci√≥n</h1>
        <p>Est√°s intentando ejecutar el juego directamente desde el archivo (Protocolo <code>file://</code>).</p>
        <p>La arquitectura moderna de M√≥dulos ES6 requiere un <strong>Servidor Web Local</strong>.</p>
    </div>

    <script>
        if (window.location.protocol === 'file:') {
            document.getElementById('server-error-overlay').style.display = 'flex';
        }
    </script>

    <button id="toggle-header-btn" aria-label="Ocultar/Mostrar encabezado">
        <i class="fas fa-arrow-up"></i> 
    </button>

    <audio id="background-music" loop src="sao_theme.mp3"></audio>

    <div class="floating-particles" id="particles"></div>
    <div id="notification-area"></div>
    <div id="combat-animation-layer"></div>

    <header>
        <nav class="container"> 
            <a href="#top" class="logo-link"> <div class="logo">‚öîÔ∏è AINCRAD</div></a>
            <div class="nav-links">
                <a href="#wiki-personajes" class="nav-link">Personajes</a>
                <a href="#wiki-arsenal" class="nav-link">Arsenal</a>
                <a href="#wiki-pisos" class="nav-link">Pisos</a>
                <a href="#game-panel" class="nav-link">Juego</a>
                <button id="music-toggle-btn" class="nav-system-btn">üîä M√∫sica</button>
            </div>
        </nav>
    </header>

    <main class="main-content container">
        <section id="game-panel" class="interactive-panel">
            <h2 class="panel-title">Tu Aventura en Aincrad</h2>
            <div class="floor-display">Piso: <span id="current-floor">1</span> - <span id="floor-name">Bosque del Inicio</span></div>

            <div class="sao-player-hud">
                <div class="sao-player-name" id="sao-player-name-display">Jugador</div>
                <div class="sao-hp-bar-container">
                    <div class="sao-hp-bar-fill" id="sao-hp-bar"></div>
                </div>
                <div class="sao-hud-stats">
                    <div class="sao-hp-text"><span id="player-hp-current">100</span>/<span id="player-hp-max">100</span></div>
                    <div class="sao-player-level">LV: <span id="player-level">1</span></div>
                </div>
                <div id="player-status-effects-display" class="status-effects-row"></div>
            </div>
            
            <div class="resource-row">
                <div class="resource-label">MP: <span id="player-mp-current">50</span>/<span id="player-mp-max">50</span></div>
                <div class="resource-bar-container">
                    <div class="resource-bar-fill" id="mp-bar-fill" style="width: 100%; background: #3498db; height: 100%;"></div>
                </div>
            </div>

            <div class="resource-row">
                <div class="resource-label">EXP: <span id="current-exp">0</span> / <span id="needed-exp">100</span></div>
                <div class="resource-bar-container">
                    <div class="resource-bar-fill" id="exp-bar-fill" style="width: 0%; background: #9b59b6; height: 100%;"></div>
                </div>
            </div>
            
            <div class="col-display">Col: <span id="player-col">0</span> üí∞</div>
            
            <div class="action-buttons">
                <button class="action-btn" id="combat-btn"><i class="fas fa-sword"></i> Combatir</button>
                <button class="action-btn" id="boss-combat-btn"><i class="fas fa-dragon"></i> Jefe del Piso</button>
                <button class="action-btn" id="train-skill-btn"><i class="fas fa-hat-wizard"></i> Habilidades</button>
                <button class="action-btn" id="inventory-btn"><i class="fas fa-backpack"></i> Inventario</button> 
                <button class="action-btn" id="shop-btn"><i class="fas fa-shopping-cart"></i> Tienda</button>
                <button class="action-btn" id="blacksmith-btn"><i class="fas fa-hammer"></i> Herrer√≠a</button>
                <button class="action-btn" id="player-stats-btn"><i class="fas fa-chart-bar"></i> Mis Stats</button>
                <button class="action-btn" id="save-game-btn"><i class="fas fa-save"></i> Guardar</button>
                <button class="action-btn" id="new-game-btn"><i class="fas fa-sync"></i> Nuevo Juego</button>
            </div>
        </section>

        <!-- Secciones Wiki -->
        <section id="wiki-personajes" class="section">
            <h2 class="section-title">Personajes</h2>
            <div id="characters-grid-display"></div>
        </section>

        <section id="wiki-arsenal" class="section">
            <h2 class="section-title">Arsenal</h2>
            <div id="weapons-grid-display"></div>
        </section>
    </main>

    <!-- Chatbot Yui -->
    <button id="chat-toggle-btn" title="Asistente Yui"><i class="fas fa-comment-dots"></i></button>
    <div id="ai-chatbot-container">
        <div class="chat-header">
            <span>Yui - Asistente MHCP</span>
            <button id="close-chat-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="chat-messages" id="chat-messages"></div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="Preg√∫ntale a Yui...">
            <button id="send-chat-btn">Enviar</button>
        </div>
    </div>

    <!-- Modals -->
    <div id="infoModal" class="modal"><div class="modal-content"><span class="close-modal-btn" data-target="infoModal">&times;</span><div id="modal-body-content"></div></div></div>
    
    <div id="inventoryModal" class="modal">
        <div class="modal-content large">
            <span class="close-modal-btn" data-target="inventoryModal">&times;</span>
            <h2>üéí Tu Inventario</h2>
            <div id="inventory-grid-display"></div>
            <div class="equipment-slots"></div>
        </div>
    </div>

    <div id="skillsModal" class="modal">
        <div class="modal-content large">
            <span class="close-modal-btn" data-target="skillsModal">&times;</span>
            <div class="skills-header">
                <h2>‚öîÔ∏è Habilidades y Talentos</h2>
                <div class="sp-counter">SP Disponibles: <span id="player-sp-display">0</span></div>
            </div>
            <div class="skills-tabs">
                <button class="skill-tab active" data-cat="sword_skills">Espada</button>
                <button class="skill-tab" data-cat="passive_skills">Pasivas</button>
                <button class="skill-tab" data-cat="talents">Talentos</button>
            </div>
            <div id="skills-grid-display"></div>
        </div>
    </div>

    <div id="playerStatsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal-btn" data-target="playerStatsModal">&times;</span>
            <h2>üìä Perfil del Jugador</h2>
            <div id="stats-content-container"></div>
        </div>
    </div>

    <div id="combatModal" class="modal">
        <div class="modal-content xlarge">
            <div id="combat-active-view">
                <h2 id="combat-title">¬°COMBATE EN CURSO!</h2>
                <div class="combat-arena">
                    <div id="combat-player-display">
                        <h3 id="combat-player-name">Jugador</h3>
                        <div class="combatant-icon"><i class="fas fa-user-ninja"></i></div>
                        <div class="sao-hp-bar-container"><div class="sao-hp-bar-fill" id="combat-player-hp-bar"></div></div>
                        <div class="hp-text"><span id="combat-player-hp-current">0</span>/<span id="combat-player-hp-max">0</span></div>
                    </div>
                    <div class="combat-vs">VS</div>
                    <div id="combat-enemy-display">
                        <h3 id="combat-enemy-name">Enemigo</h3>
                        <div class="combatant-icon" id="combat-enemy-icon">‚ùì</div>
                        <div class="sao-hp-bar-container"><div class="sao-hp-bar-fill" id="combat-enemy-hp-bar-fill"></div></div>
                        <div class="hp-text"><span id="combat-enemy-hp-current">0</span>/<span id="combat-enemy-hp-max">0</span></div>
                    </div>
                </div>
                <div id="combat-combo-display" class="combo-counter hidden">0 HITS!</div>
                <div class="combat-actions">
                    <button class="action-btn" id="combat-action-attack">Atacar</button>
                    <button class="action-btn" id="combat-show-skills">Habilidades</button>
                    <button class="action-btn" id="combat-show-potions">Objetos</button>
                </div>
                <div id="combat-skills-list-container" class="combat-sub-menu" style="display:none;"></div>
                <div id="combat-potions-list-container" class="combat-sub-menu" style="display:none;"></div>
                <div class="combat-log" id="combat-log-display"></div>
            </div>
            <div id="combat-results-view" style="display:none;"></div>
        </div>
    </div>

    <div id="nameEntryModal" class="modal">
        <div class="modal-content">
            <h2>LINK START</h2>
            <p>Por favor, ingresa tu nombre de jugador para sincronizar con el sistema Cardinal.</p>
            <input type="text" id="playerNameInput" maxlength="15" placeholder="Nombre de avatar...">
            <button class="action-btn" id="submitPlayerNameBtn">Confirmar</button>
        </div>
    </div>

    <div id="mobSelectionModal" class="modal">
        <div class="modal-content">
            <span class="close-modal-btn" data-target="mobSelectionModal">&times;</span>
            <h2>Seleccionar Enemigo</h2>
            <div id="mobListContainer" class="mob-list-grid"></div>
        </div>
    </div>

    <script type="module" src="src/main.js"></script>
</body>
</html>
