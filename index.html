
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sword Art Online: Aincrad Chronicles</title>
    
    <link rel="stylesheet" href="css/style-wiki.css">
    <link rel="stylesheet" href="css/style-game.css">
    <link rel="stylesheet" href="css/custom-scroll.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@600;800&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        #server-error-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 9999;
            color: #ff6b6b; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; font-family: sans-serif; padding: 20px;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0"
  }
}
</script>
</head>

<body>
    <div id="server-error-overlay">
        <h1>âš ï¸ Error de EjecuciÃ³n</h1>
        <p>EstÃ¡s intentando ejecutar el juego directamente desde el archivo (Protocolo <code>file://</code>).</p>
        <p>La arquitectura moderna de MÃ³dulos ES6 requiere un <strong>Servidor Web Local</strong>.</p>
    </div>

    <script>
        if (window.location.protocol === 'file:') {
            document.getElementById('server-error-overlay').style.display = 'flex';
        }
    </script>

    <button id="toggle-header-btn" aria-label="Ocultar/Mostrar encabezado">
        <i class="fas fa-arrow-up"></i> 
    </button>

    <audio id="background-music" loop src="sao_theme.mp3"></audio>

    <div class="floating-particles" id="particles"></div>
    <div id="notification-area"></div>
    <div id="combat-animation-layer"></div>

    <header>
        <nav class="container"> 
            <a href="#top" class="logo-link"> <div class="logo">âš”ï¸ AINCRAD</div></a>
            <div class="nav-links">
                <a href="#wiki-personajes" class="nav-link">Personajes</a>
                <a href="#wiki-arsenal" class="nav-link">Arsenal</a>
                <a href="#wiki-pisos" class="nav-link">Pisos</a>
                <a href="#game-panel" class="nav-link">Juego</a>
                <button id="music-toggle-btn" class="nav-system-btn">ğŸ”Š MÃºsica</button>
            </div>
        </nav>
    </header>

    <main class="main-content container">
        <section id="game-panel" class="interactive-panel">
            <h2 class="panel-title">Tu Aventura en Aincrad</h2>
            <div class="floor-display">Piso: <span id="current-floor">1</span> - <span id="floor-name">Bosque del Inicio</span></div>

            <div class="sao-player-hud">
                <div class="sao-player-name" id="sao-player-name-display">Jugador</div>
                <div class="sao-hp-bar-container">
                    <div class="sao-hp-bar-fill" id="sao-hp-bar"></div>
                </div>
                <div class="sao-hud-stats">
                    <div class="sao-hp-text"><span id="player-hp-current">100</span>/<span id="player-hp-max">100</span></div>
                    <div class="sao-player-level">LV: <span id="player-level">1</span></div>
                </div>
            </div>
            
            <div class="resource-label">MP: <span id="player-mp-current">50</span>/<span id="player-mp-max">50</span></div>
            <div class="resource-bar-container">
                <div class="resource-bar-fill" id="mp-bar-fill" style="width: 100%; background: #3498db; height: 100%;"></div>
            </div>

            <div class="resource-label">EXP: <span id="current-exp">0</span> / <span id="needed-exp">100</span></div>
            <div class="resource-bar-container">
                <div class="resource-bar-fill" id="exp-bar-fill" style="width: 0%; background: #9b59b6; height: 100%;"></div>
            </div>
            
            <div class="col-display" style="margin-top: 10px;">Col: <span id="player-col">0</span> ğŸ’°</div>
            
            <div class="action-buttons">
                <button class="action-btn" id="combat-btn">ğŸ—¡ï¸ Combatir</button>
                <button class="action-btn" id="boss-combat-btn">ğŸ‘¹ Jefe del Piso</button>
                <button class="action-btn" id="train-skill-btn">âš”ï¸ Habilidades</button>
                <button class="action-btn" id="inventory-btn">ğŸ’ Inventario</button> 
                <button class="action-btn shop-btn" id="shop-btn">ğŸ›’ Tienda</button>
                <button class="action-btn blackboard-btn" id="blacksmith-btn">ğŸ› ï¸ HerrerÃ­a</button>
                <button class="action-btn" id="player-stats-btn">ğŸ“Š Mis Stats</button>
                <button class="action-btn" id="floor-navigate-btn">ğŸ—ºï¸ Pisos</button>
                <button class="action-btn" id="save-game-btn">ğŸ’¾ Guardar</button>
                <button class="action-btn" id="load-game-btn">ğŸ“‚ Cargar</button>
                <button class="action-btn" id="new-game-btn">ğŸ”„ Reiniciar</button>
            </div>
        </section>

        <!-- Secciones de Wiki -->
        <section id="wiki-personajes" class="section">
            <h2 class="section-title">Personajes</h2>
            <div class="card-grid" id="characters-grid-display"></div>
        </section>

        <section id="wiki-arsenal" class="section">
            <h2 class="section-title">Arsenal</h2>
            <div class="card-grid" id="weapons-grid-display"></div>
        </section>
    </main>

    <!-- Chatbot Yui -->
    <button id="chat-toggle-btn" title="Asistente Yui"><i class="fas fa-comment-dots"></i></button>
    <div id="ai-chatbot-container">
        <div class="chat-header">
            <span>Yui - Asistente IA</span>
            <button id="close-chat-btn" style="background:none; border:none; color:#fff; cursor:pointer;"><i class="fas fa-times"></i></button>
        </div>
        <div class="chat-messages" id="chat-messages">
            <div class="message ai">Hola, soy Yui. Â¿En quÃ© puedo ayudarte en tu aventura por Aincrad?</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="PregÃºntale a Yui...">
            <button id="send-chat-btn" class="action-btn" style="padding: 5px 15px;">Enviar</button>
        </div>
    </div>

    <!-- Modals -->
    <div id="infoModal" class="modal"><div class="modal-content"><span class="close-modal-btn" data-target="infoModal">&times;</span><div id="modal-body-content"></div></div></div>
    
    <div id="inventoryModal" class="modal">
        <div class="modal-content large">
            <span class="close-modal-btn" data-target="inventoryModal">&times;</span>
            <h2>ğŸ’ Tu Inventario</h2>
            <div id="inventory-grid-display"></div>
            <div class="equipment-slots"></div>
        </div>
    </div>

    <div id="skillsModal" class="modal">
        <div class="modal-content large">
            <span class="close-modal-btn" data-target="skillsModal">&times;</span>
            <h2>âš”ï¸ Habilidades</h2>
            <div id="skills-grid-display"></div>
        </div>
    </div>

    <div id="combatModal" class="modal">
        <div class="modal-content xlarge">
            <div id="combat-active-view">
                <h2 id="combat-title">Â¡Combate!</h2>
                <div class="combat-arena">
                    <div id="combat-player-display">
                        <h3 id="combat-player-name">Jugador</h3>
                        <div class="combatant-icon"><i class="fas fa-user-ninja"></i></div>
                        <div class="sao-hp-bar-container"><div class="sao-hp-bar-fill" id="combat-player-hp-bar"></div></div>
                    </div>
                    <div id="combat-enemy-display">
                        <h3 id="combat-enemy-name">Enemigo</h3>
                        <div class="combatant-icon" id="combat-enemy-icon">â“</div>
                        <div class="sao-hp-bar-container"><div class="sao-hp-bar-fill" id="combat-enemy-hp-bar-fill"></div></div>
                    </div>
                </div>
                <div class="combat-actions">
                    <button class="action-btn" id="combat-action-attack">ğŸ—¡ï¸ Atacar</button>
                </div>
                <div class="combat-log" id="combat-log-display"></div>
            </div>
            <div id="combat-results-view" style="display:none;"></div>
        </div>
    </div>

    <div id="nameEntryModal" class="modal">
        <div class="modal-content">
            <h2>Elige tu Nombre</h2>
            <input type="text" id="playerNameInput" maxlength="15" placeholder="Nombre...">
            <button class="action-btn" id="submitPlayerNameBtn">Confirmar</button>
        </div>
    </div>

    <div id="mobSelectionModal" class="modal">
        <div class="modal-content">
            <span class="close-modal-btn" data-target="mobSelectionModal">&times;</span>
            <h2>Selecciona un Enemigo</h2>
            <div id="mobListContainer" class="mob-list-grid"></div>
        </div>
    </div>

    <script type="module" src="src/main.js"></script>
</body>
</html>
